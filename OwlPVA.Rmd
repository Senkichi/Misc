---
title: "Spotted Owl PVA"
author: "Samuel Martin"
date: "March 28, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r, echo=FALSE}
library(ggplot2)
library(popbio)
library(stargazer)
```
**Methods**

Data were obtained from the USGS annual breeding bird survey in New Mexico, Utah, Colorado, and Arizona, and filtered for records pertaining to the Spotted Owl. Total species counts per year per state were summed and combined to create a representative yearly sample for the four state area. Lamda values of population growth were obtained by comparing count differences between years, which were then used to create the mu value by taking the mean value of lambda values transformed by application of the natural logarithm. An extinction CDF function was then run on a two century scale, presuming a quasi-extinction threshold of 10 owls, using values obtained from a linear regression of the change in log transformed lambda values by the change in time (yearly). 

It is important to note that this population viability analysis (PVA) was conducted under the following assumptions: that current conditions will persist over the next two centuries, that observer error is minimal, and that the population growth rate is not or will not be influenced by population density. 

```{r, echo=FALSE}
owls3 <- read.csv("owls3.csv")

model <- lm(ystar~xstar +0, data=owls3)
summary(model)
extcdf = function(mu,sig2,d,tmax=50)
{

  G = numeric(tmax)
  x=1:tmax
  G = pnorm((-d-mu*x)/sqrt(sig2*x)) +
    exp(-2*mu*d/sig2)* pnorm((-d+mu*x)/sqrt(sig2*x))
}

owl.cdf <- extcdf(mu = 0.04267, sig2 = (0.3396)^2, d = 10, tmax = 200)
  Year <- seq(from = 1, to = 200, by = 1)
    owl.cdf2 <- data.frame(cbind(Year, owl.cdf))

confint(model)
```

```{r, echo=FALSE}
s2 <- (0.3396)^2
s2
(46*s2)/qchisq(0.975, 46)
(46*s2)/qchisq(0.025, 46)
crow <- c("Mu", "Variance")
ccol <- c("Lower", "Estimate", "Upper")

conftable <- data.frame(matrix(c(-0.05698135, 0.04267, 0.1423147, 0.07963632, 0.1153282, 0.1819302), nrow = 2, byrow = T, dimnames = list(crow, ccol)))
```


**Results**

```{r}
ggplot(data = owl.cdf2, aes(x = Year, y = owl.cdf)) + geom_point() + labs(y = "Probability", title = "Cumulative Probability of Extinction for the next 200 years")
```
```{r}
owl.bootstrap <- countCDFxt(mu = 0.04267, sig2 = (0.3396)^2, nt = 47, Nc = 66, Ne = 10, tmax = 200)
```
```{r}
Lower <- numeric()
Estimate <- numeric()
Upper <- numeric()

for(i in 1:20){
  Lower[i] <- owl.bootstrap[i*10,2]
  Estimate[i] <- owl.bootstrap[i*10,1]
  Upper[i] <- owl.bootstrap[i*10,3]
}
year <- seq(from = 2023, to = 2213, by = 10)
year
Decennial <- cbind(year, Lower, Estimate, Upper)
```

```{r, results='asis'}
stargazer(Decennial, title = "Decennial Cumulative Extinction Probabilities")
```
